# AWS Angular Starter Kit

This repository is curated by the [Cumberland Cloud](https://cumberland-cloud.com). It contains everything you need to deploy a responsive, search-optimized **Angular** single-page-application onto an **AWS** environment.

## CloudFormation

The _cloudformation.yml_ template in the repository will provision all the resources you need to deploy the **Angular** app to the cloud. 

The next section gives a high-level overview. See [Angular on AWS](https://cumberland-cloud.com/blog/article/angular_on_aws) for more information on the **CloudFormation** template and how to use it.

### Overview

TODO

### Quickstart

If you have a domain, a hosted zone ID and an **ACM** SSL certificate ARN **and** you have the [AWS CLI installed and configured](), you can use the helper script `provision-stack` to post the template to **CloudFormation**,

```bash
./scripts/provision-stack
```

The script will prompt you to enter all of the previously mentioned information. Alternatively, you can copy the `.sample.env` file into a new `.env` file and adjust the variables there. This file is included in the `.gitignore`, so the values you store in this file will not be committed to the repo.

```bash
cp .sample.env .env
```

## CI/CD

The **CloudFormation** template will provision a **CodeCommit**-**CodePipeline**-**CodeBuild** CI/CD pipeline. You will need to grab the SSH url of the **CodeCommit** repo that was provisioned and add it as the origin to this repository. Then, push the current head of the master branch to the new remote to kick off the pipeline,

```bash
git remote add codecommit <ssh-url>
git push --set-upstream codecommit master
```

The pipeline will use the _buildspec.yml_ in the project root to build and deploy the **Angular** application to an **S3**-**CloudFront** distribution. See [CI/CD with Angular on AWS]() for more a thorough explanation of all the different components of the pipeline.

## Angular Universal

[Angular Universal]() is installed in the application so the SPA can be prerendered. The following command run from the _app_ directory will generate the prerendered distribution in the _/app/dist_ folder,

```bash
npm run prerender
```

When new pages are added, the _/app/routes.txt_ file must be updated to include that route, so the prerender

### SEOService

This services uses the configuration file _/app/src/nav.config.ts_ to inject `meta` and `og` attributes in the HTML document during the prerendering process. This assists web crawlers and search engine bots in discovering the site. 

The _nav.config.ts_ uses the interface defined in _/app/src/models.ts_ to configure the SEO attributes,

```javascript
export interface Nav {
    path: string;
    nav_id?: string;
    nav_title?: string;
    page_title?: string;
    page_description?: string;
    group?: string;
    menu?: boolean;
    data?: any;
    children?: Nav[];
    meta?: MetaConfig[];
}
```

The `data` property of `Nav` is the [json+ld structured data](https://developers.google.com/search/docs/advanced/structured-data/intro-structured-data) used by **Google** to [implement rich search result widgets](https://developers.google.com/search/docs/advanced/structured-data/search-gallery).

### MetaService

TODO

### CloudFront Edge Handlers

When an **Angular** application is prerendered, it will generate an _index.html_ for each route, as opposed to a normal **Angular** build that compiles a singe index.html and bootstraps the entire application from that entrypoint. The difference in this setup is how the server handles the initial request. In a normal application, every request, regardless of path, gets served the root _index.html_, and **Angular** handles the path with in-app routing. With a prerendered application, each request URI is routed to a handler on the server that returns that page's _index.html_ before **Angular** has a chance to intercede.

In order to accomodate this difference, the **CloudFront** distribution will need to be setup to append _index.html_ to the end of all routes, so that will be serve the correct index on each path. If unchanged, the default configuration will serve the root _index.html_ and then pass the routing to the Angular app, instead of loading that route's index.html and bootstrapping from there. This would effectively make the prerendering process moot, since the static html generated by the prerender would not be served by the **CloudFront** distribution.

The script _/scripts/cloudfront/edge\_handler.js_ is added to the [Edge Function](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/cloudfront-functions.html) middleware of the **CloudFront** distribution during the **CI/CD** pipeline build to solve this problem. 

If a new path is added to the application, the paths in this script will need updated to reflect this change. 

## Angular Material

TODO

## Preloaded Assets

TODO

### MatIconRegistry

TODO

### Themes

TODO

## HammerJS

TODO

## sitemap.xml

